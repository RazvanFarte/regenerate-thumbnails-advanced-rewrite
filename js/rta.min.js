jQuery(document).ready(function(t){function e(){}(e.prototype={offset:0,total:0,is_interrupted_process:!1,in_process:!1,formcookie:null,is_saved:!0}).init=function(){this.checkSubmitReady(),t(".select, .deselect").on("click",t.proxy(this.selectAll,this)),t(document).on("change","input, select",t.proxy(this.checkSubmitReady,this)),t(document).on("click",".rta_regenerate",t.proxy(this.processInit,this)),t(document).on("change",".table.imagesizes input, .table.imagesizes select",t.proxy(this.image_size_changed,this)),t(document).on("click",'button[name="save_settings"]',t.proxy(this.image_size_changed,this)),t(document).on("click",".table.imagesizes .btn_remove_row",t.proxy(this.remove_image_size_row,this)),t(document).on("click","#btn_add_image_size",t.proxy(this.add_image_size_row)),t(document).on("click",".rta_error_link",t.proxy(function(){this.show_errorbox(!0)},this)),this.formcookie=this.get_form_cookie(),t(document).on("change",".rta-settings-wrap input, .rta-settings-wrap select",t.proxy(this.show_save_indicator,this));var e=parseInt(this.get_cookie("rta_offset")),s=parseInt(this.get_cookie("rta_total"));isNaN(e)||isNaN(s)||e<s&&(this.is_interrupted_process=!0,this.offset=e,this.total=s,this.process())},e.prototype.checkSubmitReady=function(){processReady=!0,inputs=t('input[name^="regenerate_sizes"]:checked'),0==inputs.length&&(processReady=!1),this.in_process&&(processReady=!1),processReady?(t("button.rta_regenerate").removeClass("disabled"),t("button.rta_regenerate").prop("disabled",!1)):(t("button.rta_regenerate").addClass("disabled"),t("button.rta_regenerate").prop("disabled",!0)),this.is_saved?(t('button[name="save_settings"]').prop("disabled",!0),t('button[name="save_settings"]').addClass("disabled")):(t('button[name="save_settings"]').prop("disabled",!1),t('button[name="save_settings"]').removeClass("disabled"))},e.prototype.selectAll=function(e){var s=t(e.target).data("action"),r=t(e.target).data("target");checked="select"==s,t('input[name^="'+r+'"]').prop("checked",checked).trigger("change")},e.prototype.processInit=function(e){if(e.preventDefault(),!this.is_saved&&!confirm(rta_data.confirm_nosave))return!1;this.unset_all_cookies(),this.show_errorbox(!1),this.hide_progress(),this.show_wait(!0),this.in_process=!0,this.checkSubmitReady(),this.set_form_cookie();var s=this,r=this.get_form_cookie();t.ajax({type:"POST",dataType:"json",url:rta_data.ajaxurl,data:{nonce:rta_data.nonce_generate,action:"rta_regenerate_thumbnails",type:"general",form:JSON.stringify(r)},success:function(t){t.pCount>0?(s.offset=0,s.total=t.pCount,s.set_process_cookie(s.offset,s.total),s.process()):(s.finishProcess(),s.add_error(t.logstatus),s.show_errorlink(!0))}})},e.prototype.process=function(){offset=this.offset,total=this.total,this.in_process=!0,this.checkSubmitReady();var e=Math.round(offset/total*100);this.show_progress(e);var s=this,r=this.get_form_cookie();offset<total?t.ajax({type:"POST",dataType:"json",url:rta_data.ajaxurl,data:{nonce:rta_data.nonce_generate,action:"rta_regenerate_thumbnails",type:"submit",offset:offset,form:JSON.stringify(r)},success:function(e){e.offset<=total?("Processed"==e.logstatus&&t(".rta_progress .images img").attr("src",e.imgUrl),s.set_process_cookie(e.offset,total),s.offset=e.offset,setTimeout(function(){s.process()},1e3)):(s.set_cookie("rta_image_processed",t(".rta_progress .images img").attr("src")),s.show_errorlink(!0)),t.isArray(e.error)&&e.error.length>0&&s.add_error(e.logstatus)}}):(this.set_cookie("rta_image_processed",t(".rta_progress .images img").attr("src")),this.finishProcess(),this.show_errorlink(!0))},e.prototype.finishProcess=function(){this.in_process=!1,this.is_interrupted_process=!1,this.show_wait(!1),this.checkSubmitReady()},e.prototype.show_progress=function(e){-1!=t(".rta_progress .images img").attr("src").indexOf("http")?t(".rta_progress .images").css("opacity",100):t(".rta_progress .images").css("opacity",0);var s=289.027;e>0&&(s=Math.round(s-s*e/100)),t(".CircularProgressbar-path").css("stroke-dashoffset",s+"px"),t(".CircularProgressbar-text").html(e+"%"),t(".rta_progress").is(":visible")||(this.show_wait(!1),t(".rta_progress").removeClass("rta_hidden"),t(".rta_progress").slideDown(),t(".rta_progress").css("display","inline-block"))},e.prototype.show_wait=function(e){e?t(".rta_wait_loader").show().removeClass("rta_hidden"):t(".rta_wait_loader").hide()},e.prototype.add_error=function(e){if(""!=e){var s="";if(t.isArray(e))for(var r=0;r<=e.length;r++)s=s+'<li class="list-group-item headLi">'+e[r]+"</li>";else s='<li class="list-group-item headLi">'+e+"</li>";t(".rta_error_box ul").append(s),this.set_cookie("rta_error_box_ul",t(".rta_error_box ul").html())}},e.prototype.show_errorbox=function(e){return e?!t(".rta_error_box").is(":visible")&&t(".rta_error_box ul li").length&&t(".rta_error_box").removeClass("rta_hidden").slideDown():(t(".rta_error_box").slideUp(10),t(".rta_error_box ul").html(""),t(".rta_error_link").slideUp(10)),!1},e.prototype.show_errorlink=function(){!t(".rta_error_link").is(":visible")&&t(".rta_error_box ul li").length&&t(".rta_error_link").removeClass("rta_hidden").slideDown()},e.prototype.hide_progress=function(){var t=jQuery;t(".rta_progress .images img").attr("src",""),t(".CircularProgressbar-path").css("stroke-dashoffset","289.027px"),t(".rta_progress .images").css("opacity",0),t(".rta_progress").slideUp(),t(".CircularProgressbar-text").html("0%")},e.prototype.unset_all_cookies=function(){this.set_cookie("rta_image_processed",""),this.set_cookie("rta_offset",""),this.set_cookie("rta_total",""),this.set_cookie("rta_last_settings","")},e.prototype.set_default_values=function(){},e.prototype.set_process_cookie=function(t,e){t=parseInt(t),e=parseInt(e),isNaN(t)||this.set_cookie("rta_offset",t),isNaN(e)||this.set_cookie("rta_total",e)},e.prototype.get_form_cookie=function(){var t=this.get_cookie("rta_last_settings");return formcookie={},t.length>0&&(formcookie=JSON.parse(t)),formcookie},e.prototype.set_form_cookie=function(){var e={};t("#frm_rta_image_sizes").find("input, select").each(function(){var s=t(this).val(),r=t(this).attr("name");return r.indexOf("image_sizes[")>=0||("checkbox"==t(this).attr("type")&&!t(this).prop("checked")||(matches=r.match(/(.*?)\[(.*)\]/),void(null!==matches?(e[matches[1]]||(e[matches[1]]=[]),e[matches[1]][matches[2]]=s):e[r]=s)))}),this.set_cookie("rta_last_settings",JSON.stringify(e),10)},e.prototype.set_cookie=function(t,e,s){var r=new Date;r.setTime(r.getTime()+24*s*60*60*1e3);var o="expires="+r.toUTCString();document.cookie=t+"="+e+";"+o+";path=/"},e.prototype.get_cookie=function(t){for(var e=t+"=",s=decodeURIComponent(document.cookie).split(";"),r=0;r<s.length;r++){for(var o=s[r];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))return o.substring(e.length,o.length)}return""},e.prototype.add_image_size_row=function(){var t=jQuery,e=t(".table.imagesizes"),s=Math.random().toString(36).substring(2)+(new Date).getTime().toString(36),r=t(".row.proto").clone();t(r).attr("id",s),t(r).removeClass("proto"),e.append(r.css("display","table-row")),e.find(".header").removeClass("rta_hidden")},e.prototype.image_size_changed=function(e){e.preventDefault();var s=t(e.target).parents(".row").attr("id");this.update_thumb_name(s),this.save_image_sizes()},e.prototype.update_thumb_name=function(e){if(t("#"+e).length){var s=t("#"+e+" .image_sizes_width").val(),r=t("#"+e+" .image_sizes_height").val(),o=t("#"+e+" .image_sizes_cropping").val();s<=0&&(s=""),r<=0&&(r="");var i=("rta_thumb "+o+" "+s+"x"+r).toLowerCase().replace(/ /g,"_");t("#"+e+" .image_sizes_name").val(i)}},e.prototype.save_image_sizes=function(){this.settings_doingsave_indicator(!0);var e=rta_data.nonce_savesizes,s=this;t.ajax({type:"POST",dataType:"json",url:rta_data.ajaxurl,data:{action:"rta_save_image_sizes",nonce:e,form:t("#rta_settings_form").serialize()},success:function(e){e.error||e.new_image_sizes&&t(".thumbnail_select .checkbox-list").fadeOut(80).html(e.new_image_sizes).fadeIn(80),s.is_saved=!0,s.settings_doingsave_indicator(!1),s.checkSubmitReady()}})},e.prototype.settings_doingsave_indicator=function(e){e?t(".form_controls .save_indicator").fadeIn(20):t(".form_controls .save_indicator").fadeOut(100)},e.prototype.show_save_indicator=function(){this.is_saved=!1,this.checkSubmitReady()},e.prototype.remove_image_size_row=function(e){var s=t(e.target).parents(".row").attr("id");confirm("Are you sure you want delete it?")&&(t("#"+s).remove(),this.save_image_sizes())},window.rtaJS=new e,window.rtaJS.init()});